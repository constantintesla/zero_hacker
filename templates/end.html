{% extends 'base.html' %}
{% block title %}Врата открыты{% endblock %}
{% block content %}
<div class="panel success end-scene">
	<div class="portal">
		<div class="ring ring1"></div>
		<div class="ring ring2"></div>
		<div class="ring ring3"></div>
		<canvas id="particles"></canvas>
	</div>
	<div class="end-text">
		<h2>ACCESS GRANTED</h2>
		<p class="type" id="end-type"></p>
		<div class="grid"><a class="btn" href="{{ url_for('index') }}">К началу</a></div>
	</div>
</div>
<script>
(function(){
	// typewriter for target
	const text = '{{ target_host }}';
	const el = document.getElementById('end-type');
	let i = 0; function type(){ if(i<=text.length){ el.textContent = text.slice(0,i); i++; setTimeout(type, 50); } }
	type();
	// particles burst
	const canvas = document.getElementById('particles'); const ctx = canvas.getContext('2d');
	function resize(){ canvas.width = 280; canvas.height = 280; }
	resize();
	const particles = Array.from({length: 80}, ()=>({
		x: canvas.width/2, y: canvas.height/2,
		vx: (Math.random()*2-1)*3, vy: (Math.random()*2-1)*3,
		life: 60+Math.random()*40
	}));
	let t=0; function tick(){
		ctx.fillStyle='rgba(0,0,0,0.08)'; ctx.fillRect(0,0,canvas.width,canvas.height);
		particles.forEach(p=>{
			p.x += p.vx; p.y += p.vy; p.vy += 0.02; p.life -= 1;
			ctx.fillStyle = 'rgba(0,255,149,'+(p.life/100).toFixed(2)+')';
			ctx.fillRect(p.x, p.y, 2, 2);
		});
		if(t++<160) requestAnimationFrame(tick);
	}
	setTimeout(tick, 300);
})();
</script>
{% endblock %}
