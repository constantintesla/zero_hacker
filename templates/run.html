{% extends 'base.html' %}
{% block title %}Zero Hacker — Запуск{% endblock %}
{% block content %}
<div class="panel run">
	<h2>Запуск протокола</h2>
	<ol class="steps">
		<li class="step" id="s1">
			<h3>Шаг 1: Скан порта</h3>
			<p>Нажми «ПИНГ» три раза, чтобы открыть порт.</p>
			<div class="controls">
				<button class="btn" id="ping">ПИНГ</button>
				<span id="pcount">0/3</span>
			</div>
			<div class="result" id="r1"></div>
		</li>
		<li class="step" id="s2">
			<h3>Шаг 2: Ключ</h3>
			<p>Выбери правильный ключ (подсказка: «1111»).</p>
			<div class="controls">
				<button class="btn key" data-k="0000">0000</button>
				<button class="btn key" data-k="1111">1111</button>
				<button class="btn key" data-k="1010">1010</button>
			</div>
			<div class="result" id="r2"></div>
		</li>
		<li class="step" id="s3">
			<h3>Шаг 3: Синхронизация</h3>
			<p>Дотяни индикатор до зелёной зоны и отпусти.</p>
			<div class="controls">
				<input type="range" min="0" max="100" step="5" value="10" id="sync">
				<div class="zone"><span></span></div>
			</div>
			<div class="result" id="r3"></div>
		</li>
	</ol>
	<div class="grid"><a class="btn" id="finish" href="{{ url_for('end') }}" style="display:none">Открыть врата</a></div>
</div>
<script>
(function(){
	// Step 1
	let c=0; const ping=document.getElementById('ping'); const pcount=document.getElementById('pcount'); const r1=document.getElementById('r1');
	ping.addEventListener('click', ()=>{ c++; pcount.textContent=c+'/3'; if(c>=3){ r1.textContent='Порт открыт'; document.getElementById('s1').classList.add('done'); } });
	// Step 2
	const r2=document.getElementById('r2'); document.querySelectorAll('.key').forEach(b=> b.addEventListener('click', ()=>{ if(b.dataset.k==='1111'){ r2.textContent='Ключ принят'; document.getElementById('s2').classList.add('done'); } else { r2.textContent='Неверно'; } }));
	// Step 3
	const sync=document.getElementById('sync'); const r3=document.getElementById('r3'); const finish=document.getElementById('finish');
	function check(){ const v=+sync.value; const ok=v>=60 && v<=80; r3.textContent = ok ? 'Синхронизировано' : 'Нужна точнее'; document.getElementById('s3').classList.toggle('done', ok); finish.style.display = (document.querySelectorAll('.step.done').length===3) ? '' : 'none'; }
	sync.addEventListener('input', check); check();
})();
</script>
{% endblock %}
