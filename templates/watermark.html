{% extends 'base.html' %}
{% block title %}Zero Hacker ‚Äî –í–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏{% endblock %}
{% block content %}
<div class="panel watermark-task">
	<h2>–ó–∞–¥–∞–Ω–∏–µ 1: –°—Ç–µ–≥–∞–Ω–æ–≥—Ä–∞—Ñ–∏—è –∏ –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏</h2>
	<p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –Ω–∞–Ω–µ—Å–µ–Ω–∞ –Ω–µ–≤–∏–¥–∏–º–∞—è –≤–æ–¥—è–Ω–∞—è –º–µ—Ç–∫–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–∑—É–Ω–∫–∏ –¥–ª—è –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.</p>
	
	<div class="upload-area" id="uploadArea" style="display: none;">
		<div class="upload-content">
			<div class="upload-icon">üìÅ</div>
			<p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
			<input type="file" id="imageInput" accept="image/*" style="display: none;">
		</div>
	</div>
	
	<div class="image-container" id="imageContainer" style="display: none;">
		<div class="main-content">
			<div class="image-wrapper">
				<img id="watermarkedImage" src="" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –≤–æ–¥—è–Ω–æ–π –º–µ—Ç–∫–æ–π">
				<div class="watermark-overlay" id="watermarkOverlay">
					<div class="watermark-text">ZERO HACKER</div>
					<div class="watermark-pattern"></div>
				</div>
			</div>
			
			<div class="hacker-terminal">
				<div class="terminal-header">
					<div class="terminal-buttons">
						<span class="btn-close"></span>
						<span class="btn-minimize"></span>
						<span class="btn-maximize"></span>
					</div>
					<div class="terminal-title">STEGANALYSIS v2.1.4</div>
				</div>
				<div class="terminal-body">
					<div class="terminal-line" id="terminal-command">
						<span class="prompt">root@steganography:~$</span>
						<span class="command">./analyze_image.sh</span>
					</div>
					<div class="terminal-line hidden" id="terminal-loading">
						<span class="output">[INFO] Loading image...</span>
					</div>
					<div class="terminal-line hidden" id="terminal-scanning">
						<span class="output">[INFO] Scanning for hidden data...</span>
					</div>
					<div class="terminal-line hidden" id="terminal-warn">
						<span class="output">[WARN] No watermark detected</span>
					</div>
					<div class="terminal-line hidden" id="terminal-adjusting">
						<span class="output">[INFO] Adjusting filters...</span>
					</div>
					<div class="terminal-line hidden" id="terminal-success">
						<span class="output">[SUCCESS] Watermark revealed!</span>
					</div>
					<div class="terminal-line hidden" id="terminal-data">
						<span class="output">[DATA] Hidden message: <span class="password" id="hiddenPassword">ZERO_HACKER_2024</span></span>
					</div>
					<div class="terminal-line hidden" id="terminal-password">
						<span class="output">[INFO] Password for next task: <span class="password" id="nextTaskPassword">HACK_LEVEL_2</span></span>
					</div>
					<div class="terminal-line" id="terminal-cursor">
						<span class="prompt">root@steganography:~$</span>
						<span class="cursor">_</span>
					</div>
				</div>
			</div>
		</div>
		
		<div class="controls-panel">
			<h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è –≤–æ–¥—è–Ω–æ–π –º–µ—Ç–∫–∏:</h3>
			
			<div class="slider-group">
				<label for="brightness">–Ø—Ä–∫–æ—Å—Ç—å:</label>
				<div class="slider-container">
					<input type="range" id="brightness" min="0" max="100" value="50" class="slider" oninput="applyFilters()">
					<div class="hot-cold-indicator" id="brightnessIndicator"></div>
				</div>
				<span id="brightnessValue">50%</span>
			</div>
			
			<div class="slider-group">
				<label for="contrast">–ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å:</label>
				<div class="slider-container">
					<input type="range" id="contrast" min="0" max="100" value="50" class="slider" oninput="applyFilters()">
					<div class="hot-cold-indicator" id="contrastIndicator"></div>
				</div>
				<span id="contrastValue">50%</span>
			</div>
			
			<div class="slider-group">
				<label for="gamma">–ì–∞–º–º–∞-–∫–æ—Ä—Ä–µ–∫—Ü–∏—è:</label>
				<div class="slider-container">
					<input type="range" id="gamma" min="0" max="100" value="50" class="slider" oninput="applyFilters()">
					<div class="hot-cold-indicator" id="gammaIndicator"></div>
				</div>
				<span id="gammaValue">50%</span>
			</div>
			
			<div class="slider-group">
				<label for="saturation">–ù–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å:</label>
				<div class="slider-container">
					<input type="range" id="saturation" min="0" max="100" value="50" class="slider" oninput="applyFilters()">
					<div class="hot-cold-indicator" id="saturationIndicator"></div>
				</div>
				<span id="saturationValue">50%</span>
			</div>
			
			<div class="slider-group">
				<label for="hue">–û—Ç—Ç–µ–Ω–æ–∫:</label>
				<div class="slider-container">
					<input type="range" id="hue" min="0" max="100" value="50" class="slider" oninput="applyFilters()">
					<div class="hot-cold-indicator" id="hueIndicator"></div>
				</div>
				<span id="hueValue">50%</span>
			</div>
		</div>
	</div>
	
	<div class="result-panel" id="resultPanel" style="display: none;">
		<div class="password-revealed">
			<h4>üîê –ü–∞—Ä–æ–ª—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è:</h4>
			<div class="password-box">
				<code id="nextPassword" onclick="selectPassword()" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è">HACK_LEVEL_2</code>
			</div>
			<p class="copy-hint">üí° –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è</p>
		</div>
		<div class="next-step">
			<a class="btn" href="{{ url_for('hack_simulation') }}">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–¥–∞–Ω–∏—é 2</a>
		</div>
	</div>
	
	<style>
	.result-panel {
		position: fixed;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		background: rgba(0, 0, 0, 0.95);
		border: 2px solid #00ff95;
		border-radius: 15px;
		padding: 30px;
		box-shadow: 0 0 30px rgba(0, 255, 149, 0.8);
		z-index: 1000;
		text-align: center;
		max-width: 500px;
		width: 90%;
	}
	
	.password-revealed h4 {
		color: #00ff95;
		font-size: 20px;
		margin-bottom: 20px;
		text-shadow: 0 0 10px rgba(0, 255, 149, 0.5);
	}
	
	.password-box {
		margin: 20px 0;
	}
	
	.password-box code {
		display: block;
		background: rgba(0, 255, 149, 0.1);
		border: 2px solid #00ff95;
		border-radius: 8px;
		padding: 15px 20px;
		font-family: 'Courier New', monospace;
		font-size: 18px;
		font-weight: bold;
		color: #00ff95;
		cursor: pointer;
		transition: all 0.3s ease;
		text-shadow: 0 0 10px rgba(0, 255, 149, 0.5);
	}
	
	.password-box code:hover {
		background: rgba(0, 255, 149, 0.2);
		transform: scale(1.05);
		box-shadow: 0 0 20px rgba(0, 255, 149, 0.8);
	}
	
	.copy-hint {
		color: #00ff95;
		font-size: 14px;
		margin-top: 10px;
		opacity: 0.8;
	}
	
	.next-step {
		margin-top: 25px;
	}
	
	.next-step .btn {
		background: linear-gradient(135deg, #00ff95, #00cc77);
		color: #000;
		padding: 12px 25px;
		text-decoration: none;
		border-radius: 8px;
		font-weight: bold;
		font-size: 16px;
		transition: all 0.3s ease;
		display: inline-block;
	}
	
	.next-step .btn:hover {
		background: linear-gradient(135deg, #00cc77, #00ff95);
		transform: translateY(-2px);
		box-shadow: 0 5px 15px rgba(0, 255, 149, 0.4);
	}
	</style>
</div>

<script>
(function(){
	const uploadArea = document.getElementById('uploadArea');
	const imageInput = document.getElementById('imageInput');
	const imageContainer = document.getElementById('imageContainer');
	const watermarkedImage = document.getElementById('watermarkedImage');
	const resultPanel = document.getElementById('resultPanel');
	
	// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
	window.addEventListener('load', () => {
		loadDefaultImage();
		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∫–∞–∫ —á–µ—Ä–Ω—ã–µ
		initializeIndicators();
	});
	
	function initializeIndicators() {
		const indicators = ['brightnessIndicator', 'contrastIndicator', 'gammaIndicator', 'saturationIndicator', 'hueIndicator'];
		indicators.forEach(id => {
			const indicator = document.getElementById(id);
			if (indicator) {
				indicator.className = 'hot-cold-indicator neutral';
			}
		});
	}
	
	function loadDefaultImage() {
		// –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–µ—Ä–µ–∑ API
		fetch('/watermark/default')
			.then(response => response.json())
			.then(data => {
				if (data.success) {
					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏
					watermarkedImage.src = 'data:image/jpeg;base64,' + data.image;
					imageContainer.style.display = 'block';
					uploadArea.style.display = 'none';
					setupSliders();
				} else {
					console.error('Error loading default image:', data.error);
					// –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏
					uploadArea.style.display = 'block';
				}
			})
			.catch(error => {
				console.error('Error loading default image:', error);
				// –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏
				uploadArea.style.display = 'block';
			});
	}
	
	// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ (–¥–ª—è —Ä—É—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏)
	uploadArea.addEventListener('click', () => imageInput.click());
	uploadArea.addEventListener('dragover', (e) => {
		e.preventDefault();
		uploadArea.classList.add('dragover');
	});
	uploadArea.addEventListener('dragleave', () => {
		uploadArea.classList.remove('dragover');
	});
	uploadArea.addEventListener('drop', (e) => {
		e.preventDefault();
		uploadArea.classList.remove('dragover');
		const files = e.dataTransfer.files;
		if (files.length > 0) {
			handleFileUpload(files[0]);
		}
	});
	
	imageInput.addEventListener('change', (e) => {
		if (e.target.files.length > 0) {
			handleFileUpload(e.target.files[0]);
		}
	});
	
	function handleFileUpload(file) {
		const formData = new FormData();
		formData.append('image', file);
		
		fetch('/watermark', {
			method: 'POST',
			body: formData
		})
		.then(response => response.json())
		.then(data => {
			if (data.success) {
				watermarkedImage.src = 'data:image/png;base64,' + data.image;
				imageContainer.style.display = 'block';
				uploadArea.style.display = 'none';
				setupSliders();
			}
		})
		.catch(error => console.error('Error:', error));
	}
	
	function setupSliders() {
		const sliders = document.querySelectorAll('.slider');
		sliders.forEach(slider => {
			const valueSpan = document.getElementById(slider.id + 'Value');
			
			slider.addEventListener('input', () => {
				valueSpan.textContent = slider.value + '%';
				applyFilters();
				checkWatermarkReveal();
			});
		});
	}
	
	function applyFilters() {
		const brightness = document.getElementById('brightness').value;
		const contrast = document.getElementById('contrast').value;
		const gamma = document.getElementById('gamma').value;
		const saturation = document.getElementById('saturation').value;
		const hue = document.getElementById('hue').value;
		
		// –ü—Ä–∏–º–µ–Ω—è–µ–º CSS —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è –≤–æ–¥—è–Ω–æ–π –º–µ—Ç–∫–∏
		// –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
		const brightnessValue = brightness / 100;
		const contrastValue = contrast / 100;
		const saturationValue = saturation / 100;
		const hueValue = hue * 3.6;
		
		// –°–æ–∑–¥–∞–µ–º –±–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
		const filterValue = `
			brightness(${brightnessValue}) 
			contrast(${contrastValue}) 
			saturate(${saturationValue}) 
			hue-rotate(${hueValue}deg)
			sepia(0.1)
			invert(0.05)
		`;
		
		watermarkedImage.style.filter = filterValue;
		
		// –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è –≤–æ–¥—è–Ω–æ–π –º–µ—Ç–∫–∏
		const watermarkOverlay = document.getElementById('watermarkOverlay');
		
		if (brightness >= 60 && contrast >= 70) {
			watermarkedImage.style.mixBlendMode = 'multiply';
			watermarkedImage.style.opacity = '0.9';
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –≤–æ–¥—è–Ω–æ–π –º–µ—Ç–∫–∏
			watermarkOverlay.style.opacity = '0.8';
			watermarkOverlay.style.display = 'block';
		} else {
			watermarkedImage.style.mixBlendMode = 'normal';
			watermarkedImage.style.opacity = '1';
			
			// –°–∫—Ä—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
			watermarkOverlay.style.opacity = '0';
			watermarkOverlay.style.display = 'none';
		}
		
		// –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
		updateTerminalProgress(brightness, contrast, gamma, saturation, hue);
	}
	
	function updateTerminalProgress(brightness, contrast, gamma, saturation, hue) {
		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
		const loading = document.getElementById('terminal-loading');
		const scanning = document.getElementById('terminal-scanning');
		const warn = document.getElementById('terminal-warn');
		const adjusting = document.getElementById('terminal-adjusting');
		const success = document.getElementById('terminal-success');
		const data = document.getElementById('terminal-data');
		const password = document.getElementById('terminal-password');
		
		// –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
		if (loading.classList.contains('hidden')) {
			loading.classList.remove('hidden');
			loading.classList.add('typing');
		}
		
		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –ª—é–±–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ –ø–æ–ª–∑—É–Ω–∫–æ–≤
		if (brightness > 10 || contrast > 10 || gamma > 10 || saturation > 10 || hue > 10) {
			if (scanning.classList.contains('hidden')) {
				scanning.classList.remove('hidden');
				scanning.classList.add('typing');
			}
		}
		
		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –¥–∞–ª–µ–∫–∏ –æ—Ç —Ü–µ–ª–µ–≤—ã—Ö
		const targetBrightness = 60, targetContrast = 70, targetGamma = 50, targetSaturation = 60, targetHue = 40;
		const tolerance = 5;
		
		const brightnessOk = Math.abs(brightness - targetBrightness) <= tolerance;
		const contrastOk = Math.abs(contrast - targetContrast) <= tolerance;
		const gammaOk = Math.abs(gamma - targetGamma) <= tolerance;
		const saturationOk = Math.abs(saturation - targetSaturation) <= tolerance;
		const hueOk = Math.abs(hue - targetHue) <= tolerance;
		
		if (!brightnessOk || !contrastOk || !gammaOk || !saturationOk || !hueOk) {
			if (warn.classList.contains('hidden')) {
				warn.classList.remove('hidden');
				warn.classList.add('typing');
			}
		}
		
		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ —Ü–µ–ª–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º
		if (brightness > 40 || contrast > 50 || gamma > 30 || saturation > 40 || hue > 20) {
			if (adjusting.classList.contains('hidden')) {
				adjusting.classList.remove('hidden');
				adjusting.classList.add('typing');
			}
		}
		
		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö –∏ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –≤—Å–µ—Ö —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
		if (brightnessOk && contrastOk && gammaOk && saturationOk && hueOk) {
			if (success.classList.contains('hidden')) {
				success.classList.remove('hidden');
				success.classList.add('typing');
			}
			if (data.classList.contains('hidden')) {
				data.classList.remove('hidden');
				data.classList.add('typing');
			}
			if (password.classList.contains('hidden')) {
				password.classList.remove('hidden');
				password.classList.add('typing');
			}
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω –≤–æ–¥—è–Ω–æ–π –º–µ—Ç–∫–∏
			const watermarkPattern = document.querySelector('.watermark-pattern');
			if (watermarkPattern) {
				watermarkPattern.style.display = 'block';
				watermarkPattern.style.opacity = '1';
			}
		} else {
			// –°–∫—Ä—ã–≤–∞–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
			const watermarkPattern = document.querySelector('.watermark-pattern');
			if (watermarkPattern) {
				watermarkPattern.style.display = 'none';
				watermarkPattern.style.opacity = '0';
			}
		}
		
		// –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã "–≥–æ—Ä—è—á–æ-—Ö–æ–ª–æ–¥–Ω–æ"
		updateHotColdIndicators(brightness, contrast, gamma, saturation, hue);
	}
	
	function updateHotColdIndicators(brightness, contrast, gamma, saturation, hue) {
		const targets = { brightness: 60, contrast: 70, gamma: 50, saturation: 60, hue: 40 };
		const tolerance = 5;
		
		// –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
		updateIndicator('brightnessIndicator', brightness, targets.brightness, tolerance);
		updateIndicator('contrastIndicator', contrast, targets.contrast, tolerance);
		updateIndicator('gammaIndicator', gamma, targets.gamma, tolerance);
		updateIndicator('saturationIndicator', saturation, targets.saturation, tolerance);
		updateIndicator('hueIndicator', hue, targets.hue, tolerance);
	}
	
	function updateIndicator(id, current, target, tolerance) {
		const indicator = document.getElementById(id);
		if (!indicator) return;
		
		const distance = Math.abs(current - target);
		
		// –£–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã
		indicator.className = 'hot-cold-indicator';
		
		if (distance <= tolerance) {
			// –ò–¥–µ–∞–ª—å–Ω–æ - —Å–∏–Ω–∏–π —Å –ø—É–ª—å—Å–∞—Ü–∏–µ–π
			indicator.classList.add('perfect');
		} else if (distance <= tolerance * 2) {
			// –ì–æ—Ä—è—á–æ - –∑–µ–ª–µ–Ω—ã–π
			indicator.classList.add('hot');
		} else if (distance <= tolerance * 4) {
			// –¢–µ–ø–ª–æ - –æ—Ä–∞–Ω–∂–µ–≤—ã–π
			indicator.classList.add('warm');
		} else if (distance <= tolerance * 8) {
			// –•–æ–ª–æ–¥–Ω–æ - –∫—Ä–∞—Å–Ω—ã–π
			indicator.classList.add('cold');
		} else {
			// –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ - —á–µ—Ä–Ω—ã–π
			indicator.classList.add('neutral');
		}
	}
	
	function checkWatermarkReveal() {
		const brightness = parseInt(document.getElementById('brightness').value);
		const contrast = parseInt(document.getElementById('contrast').value);
		const gamma = parseInt(document.getElementById('gamma').value);
		const saturation = parseInt(document.getElementById('saturation').value);
		const hue = parseInt(document.getElementById('hue').value);
		
		// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã –ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è –≤–æ–¥—è–Ω–æ–π –º–µ—Ç–∫–∏
		// –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω ¬±5% –¥–ª—è –±–æ–ª–µ–µ –≥–∏–±–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
		const targetBrightness = 60, targetContrast = 70, targetGamma = 50, targetSaturation = 60, targetHue = 40;
		const tolerance = 5;
		
		const brightnessOk = Math.abs(brightness - targetBrightness) <= tolerance;
		const contrastOk = Math.abs(contrast - targetContrast) <= tolerance;
		const gammaOk = Math.abs(gamma - targetGamma) <= tolerance;
		const saturationOk = Math.abs(saturation - targetSaturation) <= tolerance;
		const hueOk = Math.abs(hue - targetHue) <= tolerance;
		
		if (brightnessOk && contrastOk && gammaOk && saturationOk && hueOk) {
			resultPanel.style.display = 'block';
			// –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è
			resultPanel.style.animation = 'fadeIn 0.5s ease-in';
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–æ–ª—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
			showPasswordForNextTask();
		} else {
			resultPanel.style.display = 'none';
		}
	}
	
	function showPasswordForNextTask() {
		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–æ–ª—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
		const passwordDisplay = document.getElementById('passwordDisplay');
		if (passwordDisplay) {
			passwordDisplay.style.display = 'block';
		}
	}
	
	function copyPassword() {
		const passwordElement = document.getElementById('nextPassword');
		const password = passwordElement.textContent;
		
		// –ü—Ä–æ–±—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API
		if (navigator.clipboard && window.isSecureContext) {
			navigator.clipboard.writeText(password).then(() => {
				showCopySuccess();
			}).catch(err => {
				console.error('–û—à–∏–±–∫–∞ —Å navigator.clipboard:', err);
				// Fallback –∫ —Å—Ç–∞—Ä–æ–º—É –º–µ—Ç–æ–¥—É
				fallbackCopyTextToClipboard(password);
			});
		} else {
			// Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
			fallbackCopyTextToClipboard(password);
		}
	}
	
	function fallbackCopyTextToClipboard(text) {
		const textArea = document.createElement("textarea");
		textArea.value = text;
		
		// –ò–∑–±–µ–≥–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫ —ç–ª–µ–º–µ–Ω—Ç—É
		textArea.style.top = "0";
		textArea.style.left = "0";
		textArea.style.position = "fixed";
		textArea.style.opacity = "0";
		
		document.body.appendChild(textArea);
		textArea.focus();
		textArea.select();
		
		try {
			const successful = document.execCommand('copy');
			if (successful) {
				showCopySuccess();
			} else {
				showCopyError();
			}
		} catch (err) {
			console.error('–û—à–∏–±–∫–∞ —Å execCommand:', err);
			showCopyError();
		}
		
		document.body.removeChild(textArea);
	}
	
	function showCopySuccess() {
		const button = document.querySelector('.btn-copy');
		const originalText = button.textContent;
		button.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
		button.style.background = '#00ff95';
		button.style.color = '#000';
		
		setTimeout(() => {
			button.textContent = originalText;
			button.style.background = '';
			button.style.color = '';
		}, 2000);
	}
	
	function showCopyError() {
		alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å. –ü–∞—Ä–æ–ª—å: ' + document.getElementById('nextPassword').textContent);
	}
	
	function selectPassword() {
		const passwordElement = document.getElementById('nextPassword');
		
		// –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π input –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
		const tempInput = document.createElement('input');
		tempInput.value = passwordElement.textContent;
		tempInput.style.position = 'fixed';
		tempInput.style.opacity = '0';
		tempInput.style.left = '-9999px';
		
		document.body.appendChild(tempInput);
		tempInput.select();
		tempInput.setSelectionRange(0, 99999); // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
		
		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
		passwordElement.style.background = 'rgba(0, 255, 149, 0.2)';
		passwordElement.style.border = '1px solid #00ff95';
		
		setTimeout(() => {
			passwordElement.style.background = '';
			passwordElement.style.border = '';
			document.body.removeChild(tempInput);
		}, 2000);
	}
})();
</script>

<style>
/* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –≤–æ–¥—è–Ω–æ–π –º–µ—Ç–∫–∏ */
@keyframes fadeIn {
	from { opacity: 0; transform: translateY(20px); }
	to { opacity: 1; transform: translateY(0); }
}

@keyframes watermarkGlow {
	0%, 100% { box-shadow: 0 0 20px rgba(0,255,149,0.3); }
	50% { box-shadow: 0 0 30px rgba(0,255,149,0.6); }
}

.watermark-revealed {
	animation: fadeIn 0.8s ease-out;
}

.watermark-pattern {
	display: flex;
	flex-direction: column;
	gap: 4px;
	margin: 16px 0;
	opacity: 0.7;
}

.pattern-line {
	height: 2px;
	background: linear-gradient(90deg, transparent, var(--green), transparent);
	animation: watermarkGlow 2s ease-in-out infinite;
}

.pattern-line:nth-child(2) {
	animation-delay: 0.5s;
}

.pattern-line:nth-child(3) {
	animation-delay: 1s;
}

.result-panel {
	background: rgba(0, 255, 149, 0.1);
	border: 2px solid var(--green);
	border-radius: 12px;
	padding: 24px;
	margin-top: 24px;
	box-shadow: 0 0 32px rgba(0,255,149,0.2);
}

.result-panel h3 {
	color: var(--green);
	margin: 0 0 16px 0;
	text-align: center;
	letter-spacing: 2px;
}

.watermark-revealed p {
	margin: 8px 0;
	text-align: center;
}

#hiddenMessage {
	color: var(--green);
	font-size: 18px;
	text-shadow: 0 0 10px rgba(0,255,149,0.5);
	animation: watermarkGlow 1.5s ease-in-out infinite;
}

.next-step {
	text-align: center;
	margin-top: 20px;
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–∑—É–Ω–∫–æ–≤ */
.slider-group {
	display: grid;
	grid-template-columns: 1fr auto;
	align-items: center;
	gap: 12px;
	margin-bottom: 16px;
	padding: 12px;
	background: rgba(0, 20, 10, 0.3);
	border-radius: 8px;
	border: 1px solid var(--dim);
}

.slider-group label {
	font-size: 14px;
	color: var(--text);
	text-transform: uppercase;
	letter-spacing: 1px;
}

.slider {
	-webkit-appearance: none;
	appearance: none;
	height: 6px;
	background: linear-gradient(90deg, rgba(0,255,149,0.3), rgba(0,255,149,0.8));
	border-radius: 3px;
	outline: none;
	transition: all 0.3s ease;
}

.slider::-webkit-slider-thumb {
	-webkit-appearance: none;
	appearance: none;
	width: 20px;
	height: 20px;
	background: var(--green);
	border-radius: 50%;
	cursor: pointer;
	box-shadow: 0 0 12px rgba(0,255,149,0.6);
	transition: all 0.3s ease;
}

.slider::-webkit-slider-thumb:hover {
	transform: scale(1.2);
	box-shadow: 0 0 16px rgba(0,255,149,0.8);
}

.slider::-moz-range-thumb {
	width: 20px;
	height: 20px;
	background: var(--green);
	border-radius: 50%;
	cursor: pointer;
	border: none;
	box-shadow: 0 0 12px rgba(0,255,149,0.6);
}

.slider-group span {
	color: var(--green);
	font-weight: bold;
	min-width: 40px;
	text-align: center;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
.sample-image-section {
	margin-top: 20px;
	padding: 16px;
	background: rgba(0, 255, 149, 0.05);
	border: 1px solid rgba(0, 255, 149, 0.2);
	border-radius: 8px;
	text-align: center;
}

.sample-image-section p {
	margin: 0 0 12px 0;
	color: var(--text);
	font-size: 14px;
	opacity: 0.8;
}

.sample-image-section .btn {
	background: linear-gradient(180deg, rgba(0,255,149,.2), rgba(0,255,149,.05));
	border: 1px solid var(--green);
	color: var(--green);
	padding: 8px 16px;
	font-size: 14px;
}

.sample-image-section .btn:hover {
	background: linear-gradient(180deg, rgba(0,255,149,.3), rgba(0,255,149,.1));
	transform: translateY(-1px);
	box-shadow: 0 4px 12px rgba(0,255,149,0.25);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –æ–≤–µ—Ä–ª–µ—è –≤–æ–¥—è–Ω–æ–π –º–µ—Ç–∫–∏ */
.image-wrapper {
	position: relative;
	display: inline-block;
}

.watermark-overlay {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	pointer-events: none;
	opacity: 0;
	transition: opacity 0.5s ease;
	display: none;
}

.watermark-text {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	color: var(--green);
	font-size: 24px;
	font-weight: bold;
	text-shadow: 0 0 10px rgba(0,255,149,0.8);
	letter-spacing: 3px;
	animation: watermarkGlow 2s ease-in-out infinite;
}

.watermark-pattern {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background: repeating-linear-gradient(
		45deg,
		transparent,
		transparent 20px,
		rgba(0,255,149,0.1) 20px,
		rgba(0,255,149,0.1) 40px
	);
	animation: watermarkPattern 3s linear infinite;
}

@keyframes watermarkPattern {
	0% { transform: translateX(0); }
	100% { transform: translateX(40px); }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
.main-content {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 24px;
	align-items: start;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ö–∞–∫–µ—Ä—Å–∫–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ */
.hacker-terminal {
	background: #000;
	border: 1px solid #333;
	border-radius: 8px;
	box-shadow: 0 0 20px rgba(0,255,149,0.3);
	font-family: 'Courier New', monospace;
	overflow: hidden;
}

.terminal-header {
	background: #1a1a1a;
	padding: 8px 12px;
	display: flex;
	justify-content: space-between;
	align-items: center;
	border-bottom: 1px solid #333;
}

.terminal-buttons {
	display: flex;
	gap: 6px;
}

.terminal-buttons span {
	width: 12px;
	height: 12px;
	border-radius: 50%;
}

.btn-close { background: #ff5f56; }
.btn-minimize { background: #ffbd2e; }
.btn-maximize { background: #27ca3f; }

.terminal-title {
	color: #00ff95;
	font-size: 12px;
	font-weight: bold;
}

.terminal-body {
	padding: 12px;
	background: #000;
	min-height: 200px;
}

.terminal-line {
	margin-bottom: 4px;
	font-size: 14px;
	line-height: 1.4;
	opacity: 1;
	transition: opacity 0.5s ease;
}

.terminal-line.hidden {
	opacity: 0;
	display: none;
}

.terminal-line.typing {
	animation: typewriter 0.5s ease-in;
}

@keyframes typewriter {
	from { 
		opacity: 0; 
		transform: translateX(-10px);
	}
	to { 
		opacity: 1; 
		transform: translateX(0);
	}
}

.prompt {
	color: #00ff95;
	font-weight: bold;
}

.command {
	color: #fff;
}

.output {
	color: #ccc;
}

.output.success {
	color: #00ff95;
}

.output.warn {
	color: #ffbd2e;
}

.output.error {
	color: #ff5f56;
}

.password {
	color: #00ff95;
	font-weight: bold;
	text-shadow: 0 0 8px rgba(0,255,149,0.5);
	animation: passwordGlow 2s ease-in-out infinite;
}

.cursor {
	animation: blink 1s infinite;
	color: #00ff95;
}

@keyframes blink {
	0%, 50% { opacity: 1; }
	51%, 100% { opacity: 0; }
}

@keyframes passwordGlow {
	0%, 100% { text-shadow: 0 0 8px rgba(0,255,149,0.5); }
	50% { text-shadow: 0 0 16px rgba(0,255,149,0.8); }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞—Ä–æ–ª—è */
.password-revealed {
	margin-top: 20px;
	padding: 16px;
	background: rgba(0, 255, 149, 0.1);
	border: 1px solid var(--green);
	border-radius: 8px;
}

.password-revealed h4 {
	color: var(--green);
	margin: 0 0 12px 0;
	text-align: center;
}

.password-box {
	display: flex;
	align-items: center;
	gap: 12px;
	background: rgba(0, 0, 0, 0.8);
	padding: 12px;
	border-radius: 6px;
	border: 1px solid var(--dim);
}

.password-box code {
	color: var(--green);
	font-family: 'Courier New', monospace;
	font-size: 16px;
	font-weight: bold;
	letter-spacing: 1px;
	text-shadow: 0 0 8px rgba(0,255,149,0.5);
	flex: 1;
	cursor: pointer;
	user-select: all;
	-webkit-user-select: all;
	-moz-user-select: all;
	-ms-user-select: all;
	padding: 8px;
	border-radius: 4px;
	transition: all 0.3s ease;
}

.password-box code:hover {
	background: rgba(0, 255, 149, 0.1);
	transform: scale(1.02);
}

.btn-copy {
	background: linear-gradient(180deg, rgba(0,255,149,.3), rgba(0,255,149,.1));
	border: 1px solid var(--green);
	color: var(--green);
	padding: 8px 16px;
	border-radius: 4px;
	cursor: pointer;
	font-size: 12px;
	text-transform: uppercase;
	letter-spacing: 1px;
	transition: all 0.3s ease;
}

.btn-copy:hover {
	background: linear-gradient(180deg, rgba(0,255,149,.4), rgba(0,255,149,.2));
	transform: translateY(-1px);
	box-shadow: 0 4px 12px rgba(0,255,149,0.25);
}

.copy-hint {
	font-size: 12px;
	color: var(--dim);
	margin-top: 8px;
	text-align: center;
	opacity: 0.7;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ "–≥–æ—Ä—è—á–æ-—Ö–æ–ª–æ–¥–Ω–æ" */
.slider-container {
	position: relative;
	display: flex;
	align-items: center;
	gap: 10px;
}

.hot-cold-indicator {
	width: 20px;
	height: 20px;
	border-radius: 50%;
	transition: all 0.3s ease;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
	border: 2px solid rgba(255, 255, 255, 0.3);
	position: relative;
	background: #333; /* –ß–µ—Ä–Ω—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
}

.hot-cold-indicator::before {
	content: '';
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	width: 8px;
	height: 8px;
	border-radius: 50%;
	background: rgba(255, 255, 255, 0.8);
	transition: all 0.3s ease;
}

.hot-cold-indicator.cold {
	background: linear-gradient(135deg, #ff0000, #ff4444);
	box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
}

.hot-cold-indicator.warm {
	background: linear-gradient(135deg, #ff8800, #ffaa00);
	box-shadow: 0 0 15px rgba(255, 136, 0, 0.5);
}

.hot-cold-indicator.hot {
	background: linear-gradient(135deg, #00ff00, #44ff44);
	box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
}

.hot-cold-indicator.perfect {
	background: linear-gradient(135deg, #0088ff, #00aaff);
	box-shadow: 0 0 20px rgba(0, 136, 255, 0.8);
	animation: pulse 1s infinite;
}

.hot-cold-indicator.neutral {
	background: #333;
	box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
}

@keyframes pulse {
	0% { transform: scale(1); }
	50% { transform: scale(1.1); }
	100% { transform: scale(1); }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è watermark-pattern */
.watermark-pattern {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	pointer-events: none;
	z-index: 10;
	background: repeating-linear-gradient(
		45deg,
		transparent,
		transparent 10px,
		rgba(0, 255, 149, 0.1) 10px,
		rgba(0, 255, 149, 0.1) 20px
	);
	animation: watermarkPulse 2s ease-in-out infinite;
	display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
	opacity: 0;
	transition: opacity 0.3s ease;
}

/* –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
.image-wrapper {
	position: relative;
	overflow: hidden;
}

@keyframes watermarkPulse {
	0%, 100% { opacity: 0.3; }
	50% { opacity: 0.7; }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
	.main-content {
		grid-template-columns: 1fr;
	}
	
	.hacker-terminal {
		order: -1;
	}
	
	.password-box {
		flex-direction: column;
		text-align: center;
	}
}
</style>
{% endblock %}
